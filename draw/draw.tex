\documentclass{article}

\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{math}


\newcommand{\diagram}[4]{ % arguments-to-math key: the four-tuple (p, a, b, r) is represented by (#1, #2, #3, #4)
  \tikzmath{ % everything else
    \points = #1;
    \maxy = \points + 1;
    \maxx = \points;
    \discs = #2;
    \abov = #3;
    \belo = \points - 2*\discs - \abov;
    \shift = #4 - 1;
    \discmidl = \maxy - \discs - 0.5;
    \discmidr = \maxy - mod(\abov + \discs + \shift, \points) - 0.5;
    function proj(\vala, \valb, \whaxis) {
      if \whaxis == 0 then {
        return \vala;
      } else {
        return \valb;
      };
    };
    % We want to work as abstractly as possible, namely, with the Heegaard generator numberings.
    % This function converts those generator numberings, along with which side one is on, to TikZ coordinates.
    function ntoxy(\n, \side, \axis) {
      if \side == 0 then {
        return proj(0, \maxy - \n, \axis);
      } else {
        return proj(\maxx, \maxy - \n, \axis);
      };
    };
    % given a point on the left side, return the endpoint number of the corresponding arc on the right side in the unshifted diagram.
    function imagenoshift(\n) {
      if \n <= 2 *\discs then { % disc point
        return \abov + \n;
      } else {
        if \n <= \points - \belo then { % above arc
          return \n - 2 * \discs;
        } else { % below arc
          return \n;
        };
      };
    };
    function drawleft(\n) {
      \sx = ntoxy(\n, 0, 0);
      \sy = ntoxy(\n, 0, 1);
      if \n <= 2 * \discs then { % no warp possible
        \ex = abs(\n - \discs - 0.5);
        \ey = \discmidl;
        {
          \node[dot] (c) at (\sx,\sy) {};
          \draw (\sx,\sy) -- (\ex,\ey);
        };
      } else {
        \otheren = imagenoshift(\n) + \shift;
        if \otheren > \points then { % warps
          \ex = \warpstart + (\points - \n) * \warpstep;
          \otherny = ntoxy(mod(\otheren - 1, \points) + 1, 1, 1);
          {
            \node[dot] (c) at (\sx,\sy) {};
            \draw (\sx, \sy) -- (\ex,0);
            \draw (\ex,\maxy) -- (\maxx,\otherny);
          };
        } else {
          \otherny = ntoxy(mod(\otheren - 1, \points) + 1, 1, 1);
          {
            \node[dot] (c) at (\sx,\sy) {};
            \draw (\sx,\sy) -- (\maxx,\otherny);
          };
        };
      };
    };
    % now actually draw it
    for \i in {1,...,\points}{
      drawleft(\i);
    };
  }
  % bounding square
  \draw (0,0) rectangle (\maxx,\maxy);
}

% Put the diagram in a tikzpicture and draw the node labels
\newcommand{\heegaard}[4]{
  \begin{tikzpicture}[dot/.style = {circle, fill, minimum size=6pt, inner sep=0pt, outer sep=0pt}, dot/.default = 6pt]
    \diagram{#1}{#2}{#3}{#4}
    \draw (0,0) node foreach \i in {1,...,#1} at (-0.5,#1-\i+1) {$\i$};
    \draw (0,0) node foreach \i in {1,...,#1} at (#1+0.5,#1-\i+1) {$\i$};
  \end{tikzpicture}
}

% % Given [p, a, b, r] and an x and a y, make an x-by-y grid of Heegaard diagrams.
\newcommand{\ucover}[6]{
  \tikzset{
    tile/.pic={
      \diagram{#1}{#2}{#3}{#4}
    }
  }
  \begin{tikzpicture}[dot/.style = {circle, fill, minimum size=6pt, inner sep=0pt, outer sep=0pt}, dot/.default = 6pt]
    \foreach \x in {1,...,#5}  {
      \foreach \y in {1,...,#6} {
        \tikzmath{
          \xorig = (\x - 1) * #1;
          \yorig = (\y - 1) * (#1 + 1);
        }
        \pic (S) at (\xorig,\yorig) {tile};
      };
    };
  \end{tikzpicture}
}

\begin{document}
\begin{center}
  \begin{tikzpicture}
    \heegaard{7}{1}{0}{5}
  \end{tikzpicture}
\end{center}
\end{document}
% Test cases: [5, 1, 1, 2], [7, 2, 1, 3], [7, 3, 1, 5], and [11, 3, 1, 5]
% PARTIAL CORRECTNESS PROOF (no intersections)
% Accept the following lemma from the (1-1) knots paper:
